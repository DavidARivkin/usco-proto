<html>
  <head>
    <title>Assembly guide viewer example</title>
      <script src="../../components/platform/platform.js"></script>
      <link rel="import" href="../tween-js/tween-js.html">
      <link rel="import" href="../../components/polymer-three-js/three-js.html">
      <link rel="import" href="../visual-helpers/visual-helpers.html">
      <link rel="import" href="../usco-base-ui/usco-iconsets.html">

<link rel="import" href="../../components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../components/core-menu-button/core-menu-button.html">
<link rel="import" href="../../components/core-tooltip/core-tooltip.html">
<link rel="import" href="../../components/core-item/core-item.html">
<link rel="import" href="../../components/core-transition/core-transition.html">
<link rel="import" href="../../components/core-theme-aware/core-theme-aware.html">

<link rel="import" href="assembly-viewer.html">
<link rel="import" href="assembly-step.html">

      <style>
         html, body, three-js, assembly-viewer{
      margin: 0;
      position: absolute;
      height: 100%;
      width:100%;
      
      -webkit-touch-callout: none;
		-webkit-user-select: none;
		-khtml-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
    }
     #perspectiveView{
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        z-index:1;
      }
      
      
       core-theme-aware.usco {
            background: salmon;
          }
          
          core-theme-aware.usco-dark {
            background: darkslategray;
            color:white;
          }
          
          core-theme-aware.usco-light {
            background: white;
            color:black;
          }
      </style>
  </head>
<body theme="usco-light">
  <!--Experimental-->
  
  
  <assembly-viewer></assembly-viewer>

  <script>
      window.addEventListener('polymer-ready', function() {
        console.log("web components ready");

        //Exploring data structures for build instructions
        //based on tracker.json datastructure from TTN ?
        instructions = {"instructions":[
            {
               "step":1,
               "text":"do some stuff",
               "parts": [
               
               ],
               "logic":"screw #0001 into #0004 at [0,2,3]",
               "images":[
                  "thumbnails/..."
               ]
            },
            {
               "step":2,
               "text":"",
               "images":[
                  "thumbnails/..."
               ]
            }
         ]};

        //TODO: branching and conditionals ?
        //TODO: what is the best way to define what goes where ? 
        /* ie : bolt M3 L 10 into HOle 1 ?
        
        //steps:
        //stop animations
        //load animation data
        //load models
        
        
        
        /* assembly instructions are a tree, with depth first assembly ("smallest"/leaves first);
        assembly steps would need to contribute to an existing hierarchy, existing outside of them
        */
        /*3DR Tiki example (top)
        <TopCorner>
          Bom: 
            - <TopCorner printedPart> : x1
            - <M3 nuts>     : x2
            - <M3L10 bolts> : x2
            - <hallEndstop> : x1
          
        - push <M3 nuts> (x2) into holes of <TopCorner.stl> for endstop mounts -> <TopCorner>
        - place <hallEndstop> (x1) into correct position on <TopCorner> -> <TopCorner>
        - screw <M3L10 bolts> (x2) into <M3 nuts>/holes to mount <hallEndstop> into <TopCorner> -> <TopCorner>
        
        <M4L10 bolt + washer>
        - put <M4 Tight washer> onto <M4L10 bolt> (x4) -> <M4L10 bolt + washer>
        - screw <M4L10 bolt + washer> (x4) into <M4 holes> on <TopCorner>
        - screw <M4 tSlot> onto <M4L10 bolt + washer>
        
        <TopStructure>
          Bom:
            - <TopCorner>       : x3
            - <20x20x200 TSlot> : x3 
          
          - slide <20x20x200 TSlot> x3 onto <TopCorner> x3 at first TNut position
          - slide together
          - tighten all <M4L10 bolt> s
        
        */
        
        bomTest = [
          {
            id:0,
            title:"topCorner",
            description:"top corner, printed",
            uri:"demo-data/TopCornerOK.stl",
          },
          {id:1,
          title:"M3 Nut",
          description:"sdfsdfd",
          uri:"demo-data/M3Nut.stl",
          },
          {id:2,
          title:"M3 Bolt, 6 mm long",
          description:"sdfsdfd",
          uri:"demo-data/M3Bolt_L6.stl",
          },
          {id:3,
          title:"M3 Bolt, 10 mm long",
          description:"sdfsdfd",
          uri:"demo-data/M3Bolt_L10.stl",
          }
        ];
        
        assemblyTest = [
           {
            name:"3DR-TIKI",
            position:[0,0,0],
            rotation:[0,0,0],
            scale:[1,1,1],
            children:[
             {
              name:"topCorner",
              uri:"demo-data/TopCornerOK.stl",
              partNumber:2,
              position:[0,0,0],
              rotation:[0,0,0],
              scale:[1,1,1],
              children:[
                {
                  name:"mountNutL",
                  uri:"demo-data/M3Nut.stl",
                  partNumber:1,
                  position:[54,-8.5,3.6],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0,0,1]
                },
                {
                  name:"mountNutR",
                  uri:"demo-data/M3Nut.stl",
                  partNumber:1,
                  position:[54,8.5,3.6],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0,0,1]
                },
                {
                  name:"hallEndstopMountBoltR",
                  uri:"demo-data/M3Bolt_L6.stl",
                  partNumber:3,
                  position:[54,8.5,5],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0,0,-1]
                },
                {
                  name:"hallEndstopMountBoltL",
                  uri:"demo-data/M3Bolt_L6.stl",
                  partNumber:3,
                  position:[54,-8.5,5],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0,0,-1]
                },
                {
                  name:"sideTSlotMountBoltL1",
                  uri:"demo-data/M3Bolt_L10.stl",
                  partNumber:4,
                  position:[70,-30,10],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0.5,1,0]
                },
                {
                  name:"sideTSlotMountBoltR1",
                  uri:"demo-data/M3Bolt_L10.stl",
                  partNumber:4,
                  position:[70,30,10],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                  up:[0.5,-1,0]
                },
                {name:"sideTSlotMountBoltL2",
                  uri:"demo-data/M3Bolt_L10.stl",
                  partNumber:4,
                   position:[45,-20,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,1,0]
                 },
                 {name:"sideTSlotMountBoltL2",
                  uri:"demo-data/M3Bolt_L10.stl",
                  partNumber:4,
                   position:[45,20,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,-1,0]
                 },
              ],
              connectors:[
                {name:"hallEndstopMount1",
                 type:"connector",
                 position:[54,-9,5],
                 rotation:[0,0,0],
                 scale:[1,1,1],
                 up:[0,0,1]
                 },
                 {name:"hallEndstopMount2",
                 type:"connector",
                 position:[54,9,5],
                 rotation:[0,0,0],
                 scale:[1,1,1],
                 up:[0,0,1]
                 },
                 {name:"tSlotMount1",
                   type:"connector",
                   position:[70,-30,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,1,0]
                 },
                 {name:"tSlotMount2",
                   type:"connector",
                   position:[70,30,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,-1,0]
                 }
                 ,
                 {name:"tSlotMount3",
                   type:"connector",
                   position:[45,-20,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,1,0]
                 },
                 {name:"tSlotMount4",
                   type:"connector",
                   position:[45,20,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[0.5,-1,0]
                 },
                 {name:"verticalTSlotMount",
                   type:"connector",
                   position:[0,0,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[-1,0,0]
                 },
                 {name:"sideTSlotSlideStartR",
                   type:"connector",
                   position:[72,45,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[1,0.57,0]
                 },
                 {name:"sideTSlotSlideEndR",
                   type:"connector",
                   position:[30,24,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[1,0.57,0]
                 },
                 {name:"sideTSlotSlideStartL",
                   type:"connector",
                   position:[72,-45,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[1,-0.57,0]
                 },
                 {name:"sideTSlotSlideEndL",
                   type:"connector",
                   position:[30,-24,10],
                   rotation:[0,0,0],
                   scale:[1,1,1],
                   up:[1,-0.57,0]
                 }
                 
              ]
             },
             { name:"bottomCorner",
              uri:"demo-data/BottomCorner.stl",
              position:[0,0,0],
              rotation:[0,0,0],
              scale:[1,1,1],
              children:[
                {
                  name:"mountNut",
                  uri:"demo-data/M3Nut.stl",
                  position:[54,-9,5],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                },
                {
                  name:"mountBolt",
                  uri:"demo-data/M3Bolt_L6.stl",
                  position:[54,9,5],
                  rotation:[0,0,0],
                  scale:[1,1,1],
                },
              ],
             }
           ]
           }
        ];
        
        finalAssembly = [
          {
            name:"BottomCorner",
            uri:"demo-data/BottomCorner.stl",
            position:[0,0,0],
            rotation:[0,0,0],
            scale:[1,1,1],
            children:[
               {name:"motorBolt0",
               type:"bolt",
               uri:"demo-data/Bolt.stl",
               connectedTo:"foo1"
               },
               {name:"motorBolt1",
               type:"bolt",
               uri:"demo-data/Bolt.stl",
               connectedTo:"foo1"
               },
               {name:"motorBolt2",
               type:"bolt",
               uri:"demo-data/Bolt.stl",
               connectedTo:"foo1"
               },
               {name:"motorBolt3",
               type:"bolt",
               uri:"demo-data/Bolt.stl",
               connectedTo:"foo1"
               }
            ],
            connectors:[
              {name:"foo1",
               type:"connector",
               position:[0,0,30],
               rotation:[0,0,0],
               scale:[1,1,1],
               }
            ]
           }
        ];

	      var assemblyViewer = document.querySelector('assembly-viewer');
	      assemblyViewer.instructions = instructions;
	      assemblyViewer.assembly = assemblyTest;
     
        
    });
  </script>  
</body>
</html>
